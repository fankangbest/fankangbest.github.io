<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>Kubectl概念解读(五)-Printer-v1.5.2 | fankangbest</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/6.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Kubectl概念解读(五)-Printer-v1.5.2</h1><a id="logo" href="/.">fankangbest</a><p class="description">多听，少说，接受每一个人的责难，但是保留自己的最后裁决。</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Kubectl概念解读(五)-Printer-v1.5.2</h1><div class="post-meta">Jul 19, 2017<span> | </span><span class="category"><a href="/categories/容器虚拟化/">容器虚拟化</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span></div><div class="post-content"><h2 id="什么是Printer"><a href="#什么是Printer" class="headerlink" title="什么是Printer"></a>什么是Printer</h2><p>Printer可以对Kubernetes中的资源按一定格式进行打印输出，Printer主要供Kubectl get命令使用。目前Kubectl主要实现了JsonPrinter, YAMLPrinter, NamePrinter, TemplatePrinter, JSONPathPrinter, CustomColumnsPrinter, VersionedPrinter, HumanReadablePrinter。</p>
<p>在对这些Printer进行分析之前，先来看下/pkg/kubectl/resource_printer.go的GetPrinter()函数：<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetPrinter</span><span class="params">(format, formatArgument <span class="keyword">string</span>, noHeaders <span class="keyword">bool</span>)</span> <span class="params">(ResourcePrinter, <span class="keyword">bool</span>, error)</span></span> &#123;</div><div class="line">	<span class="keyword">var</span> printer ResourcePrinter</div><div class="line">	<span class="keyword">switch</span> format &#123;</div><div class="line">	<span class="keyword">case</span> <span class="string">"json"</span>:</div><div class="line">		printer = &amp;JSONPrinter&#123;&#125;</div><div class="line">	<span class="keyword">case</span> <span class="string">"yaml"</span>:</div><div class="line">		printer = &amp;YAMLPrinter&#123;&#125;</div><div class="line">	<span class="keyword">case</span> <span class="string">"name"</span>:</div><div class="line">		printer = &amp;NamePrinter&#123;</div><div class="line">			<span class="comment">// <span class="doctag">TODO:</span> this is wrong, these should be provided as an argument to GetPrinter</span></div><div class="line">			Typer:   api.Scheme,</div><div class="line">			Decoder: api.Codecs.UniversalDecoder(),</div><div class="line">		&#125;</div><div class="line">	<span class="comment">//***kubectl get pods nginx-1487191267-0t8x3 -o go-template="&#123;&#123;.metadata.name&#125;&#125;"***//</span></div><div class="line">	<span class="keyword">case</span> <span class="string">"template"</span>, <span class="string">"go-template"</span>:</div><div class="line">		<span class="keyword">if</span> <span class="built_in">len</span>(formatArgument) == <span class="number">0</span> &#123;</div><div class="line">			<span class="keyword">return</span> <span class="literal">nil</span>, <span class="literal">false</span>, fmt.Errorf(<span class="string">"template format specified but no template given"</span>)</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">var</span> err error</div><div class="line">		printer, err = NewTemplatePrinter([]<span class="keyword">byte</span>(formatArgument))</div><div class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">			<span class="keyword">return</span> <span class="literal">nil</span>, <span class="literal">false</span>, fmt.Errorf(<span class="string">"error parsing template %s, %v\n"</span>, formatArgument, err)</div><div class="line">		&#125;</div><div class="line">	<span class="keyword">case</span> <span class="string">"templatefile"</span>, <span class="string">"go-template-file"</span>:</div><div class="line">		<span class="keyword">if</span> <span class="built_in">len</span>(formatArgument) == <span class="number">0</span> &#123;</div><div class="line">			<span class="keyword">return</span> <span class="literal">nil</span>, <span class="literal">false</span>, fmt.Errorf(<span class="string">"templatefile format specified but no template file given"</span>)</div><div class="line">		&#125;</div><div class="line">		data, err := ioutil.ReadFile(formatArgument)</div><div class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">			<span class="keyword">return</span> <span class="literal">nil</span>, <span class="literal">false</span>, fmt.Errorf(<span class="string">"error reading template %s, %v\n"</span>, formatArgument, err)</div><div class="line">		&#125;</div><div class="line">		printer, err = NewTemplatePrinter(data)</div><div class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">			<span class="keyword">return</span> <span class="literal">nil</span>, <span class="literal">false</span>, fmt.Errorf(<span class="string">"error parsing template %s, %v\n"</span>, <span class="keyword">string</span>(data), err)</div><div class="line">		&#125;</div><div class="line">	<span class="comment">//***kubectl get pods -o jsonpath=&#123;.items[*].metadata.name&#125;***//</span></div><div class="line">	<span class="keyword">case</span> <span class="string">"jsonpath"</span>:</div><div class="line">		<span class="keyword">if</span> <span class="built_in">len</span>(formatArgument) == <span class="number">0</span> &#123;</div><div class="line">			<span class="keyword">return</span> <span class="literal">nil</span>, <span class="literal">false</span>, fmt.Errorf(<span class="string">"jsonpath template format specified but no template given"</span>)</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">var</span> err error</div><div class="line">		printer, err = NewJSONPathPrinter(formatArgument)</div><div class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">			<span class="keyword">return</span> <span class="literal">nil</span>, <span class="literal">false</span>, fmt.Errorf(<span class="string">"error parsing jsonpath %s, %v\n"</span>, formatArgument, err)</div><div class="line">		&#125;</div><div class="line">	<span class="keyword">case</span> <span class="string">"jsonpath-file"</span>:</div><div class="line">		<span class="keyword">if</span> <span class="built_in">len</span>(formatArgument) == <span class="number">0</span> &#123;</div><div class="line">			<span class="keyword">return</span> <span class="literal">nil</span>, <span class="literal">false</span>, fmt.Errorf(<span class="string">"jsonpath file format specified but no template file file given"</span>)</div><div class="line">		&#125;</div><div class="line">		data, err := ioutil.ReadFile(formatArgument)</div><div class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">			<span class="keyword">return</span> <span class="literal">nil</span>, <span class="literal">false</span>, fmt.Errorf(<span class="string">"error reading template %s, %v\n"</span>, formatArgument, err)</div><div class="line">		&#125;</div><div class="line">		printer, err = NewJSONPathPrinter(<span class="keyword">string</span>(data))</div><div class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">			<span class="keyword">return</span> <span class="literal">nil</span>, <span class="literal">false</span>, fmt.Errorf(<span class="string">"error parsing template %s, %v\n"</span>, <span class="keyword">string</span>(data), err)</div><div class="line">		&#125;</div><div class="line">	<span class="comment">//***kubectl get pods -o custom-columns=Name:&#123;.metadata.name&#125;***//</span></div><div class="line">	<span class="keyword">case</span> <span class="string">"custom-columns"</span>:</div><div class="line">		<span class="keyword">var</span> err error</div><div class="line">		<span class="keyword">if</span> printer, err = NewCustomColumnsPrinterFromSpec(formatArgument, api.Codecs.UniversalDecoder(), noHeaders); err != <span class="literal">nil</span> &#123;</div><div class="line">			<span class="keyword">return</span> <span class="literal">nil</span>, <span class="literal">false</span>, err</div><div class="line">		&#125;</div><div class="line">	<span class="keyword">case</span> <span class="string">"custom-columns-file"</span>:</div><div class="line">		file, err := os.Open(formatArgument)</div><div class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">			<span class="keyword">return</span> <span class="literal">nil</span>, <span class="literal">false</span>, fmt.Errorf(<span class="string">"error reading template %s, %v\n"</span>, formatArgument, err)</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">defer</span> file.Close()</div><div class="line">		<span class="keyword">if</span> printer, err = NewCustomColumnsPrinterFromTemplate(file, api.Codecs.UniversalDecoder()); err != <span class="literal">nil</span> &#123;</div><div class="line">			<span class="keyword">return</span> <span class="literal">nil</span>, <span class="literal">false</span>, err</div><div class="line">		&#125;</div><div class="line">	<span class="keyword">case</span> <span class="string">"wide"</span>:</div><div class="line">		<span class="comment">//***之后的case会被执行，但default不会被执行***//</span></div><div class="line">		<span class="keyword">fallthrough</span></div><div class="line">	<span class="keyword">case</span> <span class="string">""</span>:</div><div class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, <span class="literal">false</span>, <span class="literal">nil</span></div><div class="line">	<span class="keyword">default</span>:</div><div class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, <span class="literal">false</span>, fmt.Errorf(<span class="string">"output format %q not recognized"</span>, format)</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> printer, <span class="literal">true</span>, <span class="literal">nil</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>在GetPrinter()函数中，根据传入的参数format，会生成不同类型的Printer。需要注意的是，除了”wide”, “”以外，其他的format类型都视为标准类型(generic)。非标准类型通常是和”人”相关，如”wide”和””最后都是由HumanReadablePrinter实现。</p>
<h2 id="JSONPrinter"><a href="#JSONPrinter" class="headerlink" title="JSONPrinter"></a>JSONPrinter</h2><p>JSONPrinter可以以JSON的格式打印Object。JSONPrinter调用了json.MarshalIndent()来对Obj进行JSON格式化打印。json.MarshalIndent()函数的功能和Marshal一致，只是把Object格式化成人性化阅读的JSON，有点类似”| python -mjson.tool”的功能。<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// JSONPrinter is an implementation of ResourcePrinter which outputs an object as JSON.</span></div><div class="line"><span class="keyword">type</span> JSONPrinter <span class="keyword">struct</span> &#123;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *JSONPrinter)</span> <span class="title">AfterPrint</span><span class="params">(w io.Writer, res <span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</div><div class="line">	<span class="keyword">return</span> <span class="literal">nil</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// PrintObj is an implementation of ResourcePrinter.PrintObj which simply writes the object to the Writer.</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *JSONPrinter)</span> <span class="title">PrintObj</span><span class="params">(obj runtime.Object, w io.Writer)</span> <span class="title">error</span></span> &#123;</div><div class="line">	<span class="keyword">switch</span> obj := obj.(<span class="keyword">type</span>) &#123;</div><div class="line">	<span class="keyword">case</span> *runtime.Unknown:</div><div class="line">		<span class="keyword">var</span> buf bytes.Buffer</div><div class="line">		err := json.Indent(&amp;buf, obj.Raw, <span class="string">""</span>, <span class="string">"    "</span>)</div><div class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">			<span class="keyword">return</span> err</div><div class="line">		&#125;</div><div class="line">		buf.WriteRune(<span class="string">'\n'</span>)</div><div class="line">		_, err = buf.WriteTo(w)</div><div class="line">		<span class="keyword">return</span> err</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	data, err := json.MarshalIndent(obj, <span class="string">""</span>, <span class="string">"    "</span>)</div><div class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">		<span class="keyword">return</span> err</div><div class="line">	&#125;</div><div class="line">	data = <span class="built_in">append</span>(data, <span class="string">'\n'</span>)</div><div class="line">	_, err = w.Write(data)</div><div class="line">	<span class="keyword">return</span> err</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// <span class="doctag">TODO:</span> implement HandledResources()</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *JSONPrinter)</span> <span class="title">HandledResources</span><span class="params">()</span> []<span class="title">string</span></span> &#123;</div><div class="line">	<span class="keyword">return</span> []<span class="keyword">string</span>&#123;&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>调用例子：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">kubectl get pods -o json</div></pre></td></tr></table></figure></p>
<h2 id="YAMLPrinter"><a href="#YAMLPrinter" class="headerlink" title="YAMLPrinter"></a>YAMLPrinter</h2><p>YAMLPrinter可以以YAML的格式打印Object。YAMLPrinter通过调用yaml.Marshal()把Object转换成YAML格式并进行打印。<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// YAMLPrinter is an implementation of ResourcePrinter which outputs an object as YAML.</span></div><div class="line"><span class="comment">// The input object is assumed to be in the internal version of an API and is converted</span></div><div class="line"><span class="comment">// to the given version first.</span></div><div class="line"><span class="keyword">type</span> YAMLPrinter <span class="keyword">struct</span> &#123;</div><div class="line">	version   <span class="keyword">string</span></div><div class="line">	converter runtime.ObjectConvertor</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *YAMLPrinter)</span> <span class="title">AfterPrint</span><span class="params">(w io.Writer, res <span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</div><div class="line">	<span class="keyword">return</span> <span class="literal">nil</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// PrintObj prints the data as YAML.</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *YAMLPrinter)</span> <span class="title">PrintObj</span><span class="params">(obj runtime.Object, w io.Writer)</span> <span class="title">error</span></span> &#123;</div><div class="line">	<span class="keyword">switch</span> obj := obj.(<span class="keyword">type</span>) &#123;</div><div class="line">	<span class="keyword">case</span> *runtime.Unknown:</div><div class="line">		data, err := yaml.JSONToYAML(obj.Raw)</div><div class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">			<span class="keyword">return</span> err</div><div class="line">		&#125;</div><div class="line">		_, err = w.Write(data)</div><div class="line">		<span class="keyword">return</span> err</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">//***把obj转成yaml格式***//</span></div><div class="line">	output, err := yaml.Marshal(obj)</div><div class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">		<span class="keyword">return</span> err</div><div class="line">	&#125;</div><div class="line">	_, err = fmt.Fprint(w, <span class="keyword">string</span>(output))</div><div class="line">	<span class="keyword">return</span> err</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>调用例子：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">kubectl get pods -o yaml</div></pre></td></tr></table></figure></p>
<h2 id="NamePrinter"><a href="#NamePrinter" class="headerlink" title="NamePrinter"></a>NamePrinter</h2><p>NamePrinter可以打印资源类型和名称：如pod/ubuntu-ssh-589933015-2lhgb。NamePrinter先获判断Object是否为列表，如果是列表，则递归调用PrintObj；否则先获取Object的name，然后获取Object的Kind，并转换成单数形式的GVR，然后返回。<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// NamePrinter is an implementation of ResourcePrinter which outputs "resource/name" pair of an object.</span></div><div class="line"><span class="keyword">type</span> NamePrinter <span class="keyword">struct</span> &#123;</div><div class="line">	Decoder runtime.Decoder</div><div class="line">	Typer   runtime.ObjectTyper</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *NamePrinter)</span> <span class="title">AfterPrint</span><span class="params">(w io.Writer, res <span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</div><div class="line">	<span class="keyword">return</span> <span class="literal">nil</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// PrintObj is an implementation of ResourcePrinter.PrintObj which decodes the object</span></div><div class="line"><span class="comment">// and print "resource/name" pair. If the object is a List, print all items in it.</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *NamePrinter)</span> <span class="title">PrintObj</span><span class="params">(obj runtime.Object, w io.Writer)</span> <span class="title">error</span></span> &#123;</div><div class="line">	<span class="keyword">if</span> meta.IsListType(obj) &#123;</div><div class="line">		items, err := meta.ExtractList(obj)</div><div class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">			<span class="keyword">return</span> err</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">if</span> errs := runtime.DecodeList(items, p.Decoder, runtime.UnstructuredJSONScheme); <span class="built_in">len</span>(errs) &gt; <span class="number">0</span> &#123;</div><div class="line">			<span class="keyword">return</span> utilerrors.NewAggregate(errs)</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">for</span> _, obj := <span class="keyword">range</span> items &#123;</div><div class="line">			<span class="keyword">if</span> err := p.PrintObj(obj, w); err != <span class="literal">nil</span> &#123;</div><div class="line">				<span class="keyword">return</span> err</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> <span class="literal">nil</span></div><div class="line">	&#125;</div><div class="line"></div><div class="line">	name := <span class="string">"&lt;unknown&gt;"</span></div><div class="line">	<span class="comment">//***获取name***//</span></div><div class="line">	<span class="keyword">if</span> acc, err := meta.Accessor(obj); err == <span class="literal">nil</span> &#123;</div><div class="line">		<span class="keyword">if</span> n := acc.GetName(); <span class="built_in">len</span>(n) &gt; <span class="number">0</span> &#123;</div><div class="line">			name = n</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">if</span> kind := obj.GetObjectKind().GroupVersionKind(); <span class="built_in">len</span>(kind.Kind) == <span class="number">0</span> &#123;</div><div class="line">		<span class="comment">// this is the old code.  It's unnecessary on decoded external objects, but on internal objects</span></div><div class="line">		<span class="comment">// you may have to do it.  Tests are definitely calling it with internals and I'm not sure who else</span></div><div class="line">		<span class="comment">// is</span></div><div class="line">		<span class="keyword">if</span> gvks, _, err := p.Typer.ObjectKinds(obj); err == <span class="literal">nil</span> &#123;</div><div class="line">			<span class="comment">// <span class="doctag">TODO:</span> this is wrong, it assumes that meta knows about all Kinds - should take a RESTMapper</span></div><div class="line">			_, resource := meta.KindToResource(gvks[<span class="number">0</span>])</div><div class="line">			fmt.Fprintf(w, <span class="string">"%s/%s\n"</span>, resource.Resource, name)</div><div class="line">		&#125; <span class="keyword">else</span> &#123;</div><div class="line">			fmt.Fprintf(w, <span class="string">"&lt;unknown&gt;/%s\n"</span>, name)</div><div class="line">		&#125;</div><div class="line"></div><div class="line">	&#125; <span class="keyword">else</span> &#123;</div><div class="line">		<span class="comment">// <span class="doctag">TODO:</span> this is wrong, it assumes that meta knows about all Kinds - should take a RESTMapper</span></div><div class="line">		<span class="comment">//***直接调用KindToResource()把GVK转换成GVR，并选用单数形式***//</span></div><div class="line">		_, resource := meta.KindToResource(kind)</div><div class="line">		fmt.Fprintf(w, <span class="string">"%s/%s\n"</span>, resource.Resource, name)</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">return</span> <span class="literal">nil</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>调用例子：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span> kubectl get pods -o name</div><div class="line">pod/nginx-1487191267-0t8x3</div><div class="line">pod/ubuntu-ssh-589933015-2lhgb</div></pre></td></tr></table></figure></p>
<h2 id="TemplatePrinter"><a href="#TemplatePrinter" class="headerlink" title="TemplatePrinter"></a>TemplatePrinter</h2><p>TemplatePrinter基于txt/template包实现。txt/template一般的用法为：<br>定义模板：<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tmpl, err := template.New(<span class="string">"test"</span>).Parse(<span class="string">"hello, &#123;&#123;.&#125;&#125;"</span>)</div></pre></td></tr></table></figure></p>
<p>执行：<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">err = tmpl.Execute(os.Stdout, name)</div></pre></td></tr></table></figure></p>
<p>TemplatePrinter定义如下：<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// TemplatePrinter is an implementation of ResourcePrinter which formats data with a Go Template.</span></div><div class="line"><span class="comment">//***调用text/template包***//</span></div><div class="line"><span class="keyword">type</span> TemplatePrinter <span class="keyword">struct</span> &#123;</div><div class="line">	rawTemplate <span class="keyword">string</span></div><div class="line">	template    *template.Template</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewTemplatePrinter</span><span class="params">(tmpl []<span class="keyword">byte</span>)</span> <span class="params">(*TemplatePrinter, error)</span></span> &#123;</div><div class="line">	t, err := template.New(<span class="string">"output"</span>).</div><div class="line">		Funcs(template.FuncMap&#123;<span class="string">"exists"</span>: exists&#125;).</div><div class="line">		Parse(<span class="keyword">string</span>(tmpl))</div><div class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, err</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> &amp;TemplatePrinter&#123;</div><div class="line">		rawTemplate: <span class="keyword">string</span>(tmpl),</div><div class="line">		template:    t,</div><div class="line">	&#125;, <span class="literal">nil</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *TemplatePrinter)</span> <span class="title">AfterPrint</span><span class="params">(w io.Writer, res <span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</div><div class="line">	<span class="keyword">return</span> <span class="literal">nil</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// PrintObj formats the obj with the Go Template.</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *TemplatePrinter)</span> <span class="title">PrintObj</span><span class="params">(obj runtime.Object, w io.Writer)</span> <span class="title">error</span></span> &#123;</div><div class="line">	<span class="keyword">var</span> data []<span class="keyword">byte</span></div><div class="line">	<span class="keyword">var</span> err error</div><div class="line">	<span class="keyword">if</span> unstructured, ok := obj.(*runtime.Unstructured); ok &#123;</div><div class="line">		data, err = json.Marshal(unstructured.Object)</div><div class="line">	&#125; <span class="keyword">else</span> &#123;</div><div class="line">		data, err = json.Marshal(obj)</div><div class="line"></div><div class="line">	&#125;</div><div class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">		<span class="keyword">return</span> err</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	out := <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>&#123;&#125;&#123;&#125;</div><div class="line">	<span class="keyword">if</span> err := json.Unmarshal(data, &amp;out); err != <span class="literal">nil</span> &#123;</div><div class="line">		<span class="keyword">return</span> err</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">if</span> err = p.safeExecute(w, out); err != <span class="literal">nil</span> &#123;</div><div class="line">		<span class="comment">// It is way easier to debug this stuff when it shows up in</span></div><div class="line">		<span class="comment">// stdout instead of just stdin. So in addition to returning</span></div><div class="line">		<span class="comment">// a nice error, also print useful stuff with the writer.</span></div><div class="line">		fmt.Fprintf(w, <span class="string">"Error executing template: %v. Printing more information for debugging the template:\n"</span>, err)</div><div class="line">		fmt.Fprintf(w, <span class="string">"\ttemplate was:\n\t\t%v\n"</span>, p.rawTemplate)</div><div class="line">		fmt.Fprintf(w, <span class="string">"\traw data was:\n\t\t%v\n"</span>, <span class="keyword">string</span>(data))</div><div class="line">		fmt.Fprintf(w, <span class="string">"\tobject given to template engine was:\n\t\t%+v\n\n"</span>, out)</div><div class="line">		<span class="keyword">return</span> fmt.Errorf(<span class="string">"error executing template %q: %v"</span>, p.rawTemplate, err)</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="literal">nil</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// <span class="doctag">TODO:</span> implement HandledResources()</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *TemplatePrinter)</span> <span class="title">HandledResources</span><span class="params">()</span> []<span class="title">string</span></span> &#123;</div><div class="line">	<span class="keyword">return</span> []<span class="keyword">string</span>&#123;&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>调用例子：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span> kubectl get pods nginx-1487191267-0t8x3 -o go-template="The name is &#123;&#123;.metadata.name&#125;&#125;"</div><div class="line">The name is nginx-1487191267-0t8x3</div></pre></td></tr></table></figure></p>
<p>或者<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span> kubectl get pods nginx-1487191267-0t8x3 -o go-template-file=template </div><div class="line">The name is nginx-1487191267-0t8x3</div></pre></td></tr></table></figure></p>
<p>其中<code>go-template-file=template</code>的template为文件，内容为:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">The name is &#123;&#123;.metadata.name&#125;&#125;</div></pre></td></tr></table></figure></p>
<h2 id="JSONPathPrinter"><a href="#JSONPathPrinter" class="headerlink" title="JSONPathPrinter"></a>JSONPathPrinter</h2><p>JSONPathPrinter实现了一套匹配规则，详见<a href="https://kubernetes.io/docs/user-guide/jsonpath/。" target="_blank" rel="external">https://kubernetes.io/docs/user-guide/jsonpath/。</a><br>jsonpath具体在/pkg/util/jsonpath/jsonpath.go中实现，具体分析此处略。<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// JSONPathPrinter is an implementation of ResourcePrinter which formats data with jsonpath expression.</span></div><div class="line"><span class="keyword">type</span> JSONPathPrinter <span class="keyword">struct</span> &#123;</div><div class="line">	rawTemplate <span class="keyword">string</span></div><div class="line">	*jsonpath.JSONPath</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewJSONPathPrinter</span><span class="params">(tmpl <span class="keyword">string</span>)</span> <span class="params">(*JSONPathPrinter, error)</span></span> &#123;</div><div class="line">	j := jsonpath.New(<span class="string">"out"</span>)</div><div class="line">	<span class="keyword">if</span> err := j.Parse(tmpl); err != <span class="literal">nil</span> &#123;</div><div class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, err</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> &amp;JSONPathPrinter&#123;tmpl, j&#125;, <span class="literal">nil</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(j *JSONPathPrinter)</span> <span class="title">AfterPrint</span><span class="params">(w io.Writer, res <span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</div><div class="line">	<span class="keyword">return</span> <span class="literal">nil</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// PrintObj formats the obj with the JSONPath Template.</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(j *JSONPathPrinter)</span> <span class="title">PrintObj</span><span class="params">(obj runtime.Object, w io.Writer)</span> <span class="title">error</span></span> &#123;</div><div class="line">	<span class="keyword">var</span> queryObj <span class="keyword">interface</span>&#123;&#125; = obj</div><div class="line">	<span class="keyword">if</span> meta.IsListType(obj) &#123;</div><div class="line">		data, err := json.Marshal(obj)</div><div class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">			<span class="keyword">return</span> err</div><div class="line">		&#125;</div><div class="line">		queryObj = <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>&#123;&#125;&#123;&#125;</div><div class="line">		<span class="keyword">if</span> err := json.Unmarshal(data, &amp;queryObj); err != <span class="literal">nil</span> &#123;</div><div class="line">			<span class="keyword">return</span> err</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">if</span> unknown, ok := obj.(*runtime.Unknown); ok &#123;</div><div class="line">		data, err := json.Marshal(unknown)</div><div class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">			<span class="keyword">return</span> err</div><div class="line">		&#125;</div><div class="line">		queryObj = <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>&#123;&#125;&#123;&#125;</div><div class="line">		<span class="keyword">if</span> err := json.Unmarshal(data, &amp;queryObj); err != <span class="literal">nil</span> &#123;</div><div class="line">			<span class="keyword">return</span> err</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">if</span> unstructured, ok := obj.(*runtime.Unstructured); ok &#123;</div><div class="line">		queryObj = unstructured.Object</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">if</span> err := j.JSONPath.Execute(w, queryObj); err != <span class="literal">nil</span> &#123;</div><div class="line">		fmt.Fprintf(w, <span class="string">"Error executing template: %v. Printing more information for debugging the template:\n"</span>, err)</div><div class="line">		fmt.Fprintf(w, <span class="string">"\ttemplate was:\n\t\t%v\n"</span>, j.rawTemplate)</div><div class="line">		fmt.Fprintf(w, <span class="string">"\tobject given to jsonpath engine was:\n\t\t%#v\n\n"</span>, queryObj)</div><div class="line">		<span class="keyword">return</span> fmt.Errorf(<span class="string">"error executing jsonpath %q: %v\n"</span>, j.rawTemplate, err)</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="literal">nil</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// <span class="doctag">TODO:</span> implement HandledResources()</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *JSONPathPrinter)</span> <span class="title">HandledResources</span><span class="params">()</span> []<span class="title">string</span></span> &#123;</div><div class="line">	<span class="keyword">return</span> []<span class="keyword">string</span>&#123;&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>调用例子：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span> kubectl get pods -o jsonpath=&#123;.items[*].metadata.name&#125;</div><div class="line">nginx-1487191267-0t8x3 ubuntu-ssh-589933015-2lhgb</div></pre></td></tr></table></figure></p>
<p>或者<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span> kubectl get pods -o jsonpath-file=template</div><div class="line">nginx-1487191267-0t8x3 ubuntu-ssh-589933015-2lhgb</div></pre></td></tr></table></figure></p>
<p>其中<code>jsonpath-file=template</code>的template为文件，内容为:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;.items[*].metadata.name&#125;</div></pre></td></tr></table></figure></p>
<h2 id="CustomColumnsPrinter"><a href="#CustomColumnsPrinter" class="headerlink" title="CustomColumnsPrinter"></a>CustomColumnsPrinter</h2><p>CustomColumnsPrinter允许用户定义列名，是JSONPath的加强版。支持从命令行直接输入模板和从文件读取模板两种方式。</p>
<p>读取命令行模板的CustomColumnsPrinter生成函数如下：<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//***kubectl get pods -o custom-columns=Type:&#123;.kind&#125;,Name:&#123;.metadata.name&#125;***//</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewCustomColumnsPrinterFromSpec</span><span class="params">(spec <span class="keyword">string</span>, decoder runtime.Decoder, noHeaders <span class="keyword">bool</span>)</span> <span class="params">(*CustomColumnsPrinter, error)</span></span> &#123;</div><div class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(spec) == <span class="number">0</span> &#123;</div><div class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, fmt.Errorf(<span class="string">"custom-columns format specified but no custom columns given"</span>)</div><div class="line">	&#125;</div><div class="line">	<span class="comment">//***parts: [Type:&#123;.kind&#125; Name:&#123;.metadata.name&#125;]***//</span></div><div class="line">	parts := strings.Split(spec, <span class="string">","</span>)</div><div class="line">	columns := <span class="built_in">make</span>([]Column, <span class="built_in">len</span>(parts))</div><div class="line">	<span class="keyword">for</span> ix := <span class="keyword">range</span> parts &#123;</div><div class="line">		colSpec := strings.Split(parts[ix], <span class="string">":"</span>)</div><div class="line">		<span class="keyword">if</span> <span class="built_in">len</span>(colSpec) != <span class="number">2</span> &#123;</div><div class="line">			<span class="keyword">return</span> <span class="literal">nil</span>, fmt.Errorf(<span class="string">"unexpected custom-columns spec: %s, expected &lt;header&gt;:&lt;json-path-expr&gt;"</span>, parts[ix])</div><div class="line">		&#125;</div><div class="line">		spec, err := massageJSONPath(colSpec[<span class="number">1</span>])</div><div class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">			<span class="keyword">return</span> <span class="literal">nil</span>, err</div><div class="line">		&#125;</div><div class="line">		columns[ix] = Column&#123;Header: colSpec[<span class="number">0</span>], FieldSpec: spec&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> &amp;CustomColumnsPrinter&#123;Columns: columns, Decoder: decoder, NoHeaders: noHeaders&#125;, <span class="literal">nil</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>读取文件模板的CustomColumnsPrinter生成函数如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">//***kubectl get pods -o custom-columns-file=/home/fankang/template***//</div><div class="line">func NewCustomColumnsPrinterFromTemplate(templateReader io.Reader, decoder runtime.Decoder) (*CustomColumnsPrinter, error) &#123;</div><div class="line">	scanner := bufio.NewScanner(templateReader)</div><div class="line">	if !scanner.Scan() &#123;</div><div class="line">		return nil, fmt.Errorf(&quot;invalid template, missing header line. Expected format is one line of space separated headers, one line of space separated column specs.&quot;)</div><div class="line">	&#125;</div><div class="line">	//***headers: [Type Name]***//</div><div class="line">	headers := splitOnWhitespace(scanner.Text())</div><div class="line"></div><div class="line">	if !scanner.Scan() &#123;</div><div class="line">		return nil, fmt.Errorf(&quot;invalid template, missing spec line. Expected format is one line of space separated headers, one line of space separated column specs.&quot;)</div><div class="line">	&#125;</div><div class="line">	//***specs: [&#123;.kind&#125; &#123;.metadata.name&#125;]***//</div><div class="line">	specs := splitOnWhitespace(scanner.Text())</div><div class="line"></div><div class="line">	//***如果headers和specs长度不一致，则直接返回***//</div><div class="line">	if len(headers) != len(specs) &#123;</div><div class="line">		return nil, fmt.Errorf(&quot;number of headers (%d) and field specifications (%d) don&apos;t match&quot;, len(headers), len(specs))</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	columns := make([]Column, len(headers))</div><div class="line">	for ix := range headers &#123;</div><div class="line">		spec, err := massageJSONPath(specs[ix])</div><div class="line">		if err != nil &#123;</div><div class="line">			return nil, err</div><div class="line">		&#125;</div><div class="line">		//***组装成Column***//</div><div class="line">		columns[ix] = Column&#123;</div><div class="line">			Header:    headers[ix],</div><div class="line">			FieldSpec: spec,</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	//***返回CustomColumnsPrinter***//</div><div class="line">	return &amp;CustomColumnsPrinter&#123;Columns: columns, Decoder: decoder, NoHeaders: false&#125;, nil</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>CustomColumnsPrinter的PrintObj()方法如下，可以看出，调用了jsonpath.New()来解析模板。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">func (s *CustomColumnsPrinter) PrintObj(obj runtime.Object, out io.Writer) error &#123;</div><div class="line">	w := tabwriter.NewWriter(out, columnwidth, tabwidth, padding, padding_character, flags)</div><div class="line"></div><div class="line">	if !s.NoHeaders &#123;</div><div class="line">		headers := make([]string, len(s.Columns))</div><div class="line">		for ix := range s.Columns &#123;</div><div class="line">			headers[ix] = s.Columns[ix].Header</div><div class="line">		&#125;</div><div class="line">		fmt.Fprintln(w, strings.Join(headers, &quot;\t&quot;))</div><div class="line">	&#125;</div><div class="line">	parsers := make([]*jsonpath.JSONPath, len(s.Columns))</div><div class="line">	for ix := range s.Columns &#123;</div><div class="line">		parsers[ix] = jsonpath.New(fmt.Sprintf(&quot;column%d&quot;, ix))</div><div class="line">		if err := parsers[ix].Parse(s.Columns[ix].FieldSpec); err != nil &#123;</div><div class="line">			return err</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	if meta.IsListType(obj) &#123;</div><div class="line">		objs, err := meta.ExtractList(obj)</div><div class="line">		if err != nil &#123;</div><div class="line">			return err</div><div class="line">		&#125;</div><div class="line">		for ix := range objs &#123;</div><div class="line">			if err := s.printOneObject(objs[ix], parsers, w); err != nil &#123;</div><div class="line">				return err</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125; else &#123;</div><div class="line">		if err := s.printOneObject(obj, parsers, w); err != nil &#123;</div><div class="line">			return err</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	return w.Flush()</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>调用例子：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span> kubectl get pods -o custom-columns=Type:&#123;.kind&#125;,Name:&#123;.metadata.name&#125;</div><div class="line">Type      Name</div><div class="line">Pod       nginx-1487191267-0t8x3</div><div class="line">Pod       ubuntu-ssh-589933015-2lhgb</div></pre></td></tr></table></figure></p>
<p>或者<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span> kubectl get pods -o custom-columns-file=template</div><div class="line">Type      Name</div><div class="line">Pod       nginx-1487191267-0t8x3</div><div class="line">Pod       ubuntu-ssh-589933015-2lhgb</div></pre></td></tr></table></figure></p>
<p>其中<code>custom-columns-file=template</code>的template为文件，内容为:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Type              Name</div><div class="line">&#123;.kind&#125;           &#123;.metadata.name&#125;</div></pre></td></tr></table></figure></p>
<h2 id="VersionedPrinter"><a href="#VersionedPrinter" class="headerlink" title="VersionedPrinter"></a>VersionedPrinter</h2><p>VersionedPrinter是对其他Printer的封装，先把Object转换成对应版本的Object，然后再封装的Printer进行打印。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">// VersionedPrinter takes runtime objects and ensures they are converted to a given API version</div><div class="line">// prior to being passed to a nested printer.</div><div class="line">type VersionedPrinter struct &#123;</div><div class="line">	printer   ResourcePrinter</div><div class="line">	converter runtime.ObjectConvertor</div><div class="line">	versions  []unversioned.GroupVersion</div><div class="line">&#125;</div><div class="line"></div><div class="line">// NewVersionedPrinter wraps a printer to convert objects to a known API version prior to printing.</div><div class="line">func NewVersionedPrinter(printer ResourcePrinter, converter runtime.ObjectConvertor, versions ...unversioned.GroupVersion) ResourcePrinter &#123;</div><div class="line">	return &amp;VersionedPrinter&#123;</div><div class="line">		printer:   printer,</div><div class="line">		converter: converter,</div><div class="line">		versions:  versions,</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">func (p *VersionedPrinter) AfterPrint(w io.Writer, res string) error &#123;</div><div class="line">	return nil</div><div class="line">&#125;</div><div class="line"></div><div class="line">// PrintObj implements ResourcePrinter</div><div class="line">func (p *VersionedPrinter) PrintObj(obj runtime.Object, w io.Writer) error &#123;</div><div class="line">	if len(p.versions) == 0 &#123;</div><div class="line">		return fmt.Errorf(&quot;no version specified, object cannot be converted&quot;)</div><div class="line">	&#125;</div><div class="line">	converted, err := p.converter.ConvertToVersion(obj, unversioned.GroupVersions(p.versions))</div><div class="line">	if err != nil &#123;</div><div class="line">		return err</div><div class="line">	&#125;</div><div class="line">	return p.printer.PrintObj(converted, w)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>version由<code>kubectl get pods --output-version=&#39;v1&#39; -o yaml -w</code>的–output-version指定，但没什么作用，而且kubectl get代码中只有Watch会使用VersionedPrinter，所以还待更深入的研究。</p>
<h2 id="HumanReadablePrinter"><a href="#HumanReadablePrinter" class="headerlink" title="HumanReadablePrinter"></a>HumanReadablePrinter</h2><p>HumanReadablePrinter可以”人性化”地输出内容。HumanReadablePrinter中有handlerMap，handlerMap记录了待打印的对象到处理函数的映射关系。系统中每种资源都有对应的打印函数。</p>
<p>其中<code>kubectl -o wide</code>调用的也是HumanReadablePrinter。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div></pre></td><td class="code"><pre><div class="line">type HumanReadablePrinter struct &#123;</div><div class="line">	handlerMap   map[reflect.Type]*handlerEntry</div><div class="line">	options      PrintOptions</div><div class="line">	lastType     reflect.Type</div><div class="line">	hiddenObjNum int</div><div class="line">&#125;</div><div class="line"></div><div class="line">// NewHumanReadablePrinter creates a HumanReadablePrinter.</div><div class="line">//***创建HumanReadablePrinter***//</div><div class="line">func NewHumanReadablePrinter(options PrintOptions) *HumanReadablePrinter &#123;</div><div class="line">	printer := &amp;HumanReadablePrinter&#123;</div><div class="line">		handlerMap: make(map[reflect.Type]*handlerEntry),</div><div class="line">		options:    options,</div><div class="line">	&#125;</div><div class="line">	printer.addDefaultHandlers()</div><div class="line">	return printer</div><div class="line">&#125;</div><div class="line"></div><div class="line">//***打印第一行标题***//</div><div class="line">func (h *HumanReadablePrinter) printHeader(columnNames []string, w io.Writer) error &#123;</div><div class="line">	if _, err := fmt.Fprintf(w, &quot;%s\n&quot;, strings.Join(columnNames, &quot;\t&quot;)); err != nil &#123;</div><div class="line">		return err</div><div class="line">	&#125;</div><div class="line">	return nil</div><div class="line">&#125;</div><div class="line"></div><div class="line">//***打印Pod***//</div><div class="line">func (h *HumanReadablePrinter) printPod(pod *api.Pod, w io.Writer, options PrintOptions) error &#123;</div><div class="line">	if err := printPodBase(pod, w, options); err != nil &#123;</div><div class="line">		return err</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	return nil</div><div class="line">&#125;</div><div class="line"></div><div class="line">func printPodBase(pod *api.Pod, w io.Writer, options PrintOptions) error &#123;</div><div class="line">	name := formatResourceName(options.Kind, pod.Name, options.WithKind)</div><div class="line">	namespace := pod.Namespace</div><div class="line"></div><div class="line">	restarts := 0</div><div class="line">	totalContainers := len(pod.Spec.Containers)</div><div class="line">	readyContainers := 0</div><div class="line"></div><div class="line">	reason := string(pod.Status.Phase)</div><div class="line">	if pod.Status.Reason != &quot;&quot; &#123;</div><div class="line">		reason = pod.Status.Reason</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	initializing := false</div><div class="line">	for i := range pod.Status.InitContainerStatuses &#123;</div><div class="line">		container := pod.Status.InitContainerStatuses[i]</div><div class="line">		restarts += int(container.RestartCount)</div><div class="line">		switch &#123;</div><div class="line">		case container.State.Terminated != nil &amp;&amp; container.State.Terminated.ExitCode == 0:</div><div class="line">			continue</div><div class="line">		case container.State.Terminated != nil:</div><div class="line">			// initialization is failed</div><div class="line">			if len(container.State.Terminated.Reason) == 0 &#123;</div><div class="line">				if container.State.Terminated.Signal != 0 &#123;</div><div class="line">					reason = fmt.Sprintf(&quot;Init:Signal:%d&quot;, container.State.Terminated.Signal)</div><div class="line">				&#125; else &#123;</div><div class="line">					reason = fmt.Sprintf(&quot;Init:ExitCode:%d&quot;, container.State.Terminated.ExitCode)</div><div class="line">				&#125;</div><div class="line">			&#125; else &#123;</div><div class="line">				reason = &quot;Init:&quot; + container.State.Terminated.Reason</div><div class="line">			&#125;</div><div class="line">			initializing = true</div><div class="line">		case container.State.Waiting != nil &amp;&amp; len(container.State.Waiting.Reason) &gt; 0 &amp;&amp; container.State.Waiting.Reason != &quot;PodInitializing&quot;:</div><div class="line">			reason = &quot;Init:&quot; + container.State.Waiting.Reason</div><div class="line">			initializing = true</div><div class="line">		default:</div><div class="line">			reason = fmt.Sprintf(&quot;Init:%d/%d&quot;, i, len(pod.Spec.InitContainers))</div><div class="line">			initializing = true</div><div class="line">		&#125;</div><div class="line">		break</div><div class="line">	&#125;</div><div class="line">	if !initializing &#123;</div><div class="line">		restarts = 0</div><div class="line">		for i := len(pod.Status.ContainerStatuses) - 1; i &gt;= 0; i-- &#123;</div><div class="line">			container := pod.Status.ContainerStatuses[i]</div><div class="line"></div><div class="line">			restarts += int(container.RestartCount)</div><div class="line">			if container.State.Waiting != nil &amp;&amp; container.State.Waiting.Reason != &quot;&quot; &#123;</div><div class="line">				reason = container.State.Waiting.Reason</div><div class="line">			&#125; else if container.State.Terminated != nil &amp;&amp; container.State.Terminated.Reason != &quot;&quot; &#123;</div><div class="line">				reason = container.State.Terminated.Reason</div><div class="line">			&#125; else if container.State.Terminated != nil &amp;&amp; container.State.Terminated.Reason == &quot;&quot; &#123;</div><div class="line">				if container.State.Terminated.Signal != 0 &#123;</div><div class="line">					reason = fmt.Sprintf(&quot;Signal:%d&quot;, container.State.Terminated.Signal)</div><div class="line">				&#125; else &#123;</div><div class="line">					reason = fmt.Sprintf(&quot;ExitCode:%d&quot;, container.State.Terminated.ExitCode)</div><div class="line">				&#125;</div><div class="line">			&#125; else if container.Ready &amp;&amp; container.State.Running != nil &#123;</div><div class="line">				readyContainers++</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	if pod.DeletionTimestamp != nil &amp;&amp; pod.Status.Reason == node.NodeUnreachablePodReason &#123;</div><div class="line">		reason = &quot;Unknown&quot;</div><div class="line">	&#125; else if pod.DeletionTimestamp != nil &#123;</div><div class="line">		reason = &quot;Terminating&quot;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	if options.WithNamespace &#123;</div><div class="line">		if _, err := fmt.Fprintf(w, &quot;%s\t&quot;, namespace); err != nil &#123;</div><div class="line">			return err</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	if _, err := fmt.Fprintf(w, &quot;%s\t%d/%d\t%s\t%d\t%s&quot;,</div><div class="line">		name,</div><div class="line">		readyContainers,</div><div class="line">		totalContainers,</div><div class="line">		reason,</div><div class="line">		restarts,</div><div class="line">		translateTimestamp(pod.CreationTimestamp),</div><div class="line">	); err != nil &#123;</div><div class="line">		return err</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	//***-o wide则写入IP和NODE***//</div><div class="line">	if options.Wide &#123;</div><div class="line">		nodeName := pod.Spec.NodeName</div><div class="line">		podIP := pod.Status.PodIP</div><div class="line">		if podIP == &quot;&quot; &#123;</div><div class="line">			podIP = &quot;&lt;none&gt;&quot;</div><div class="line">		&#125;</div><div class="line">		if _, err := fmt.Fprintf(w, &quot;\t%s\t%s&quot;,</div><div class="line">			podIP,</div><div class="line">			nodeName,</div><div class="line">		); err != nil &#123;</div><div class="line">			return err</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	if _, err := fmt.Fprint(w, AppendLabels(pod.Labels, options.ColumnLabels)); err != nil &#123;</div><div class="line">		return err</div><div class="line">	&#125;</div><div class="line">	if _, err := fmt.Fprint(w, AppendAllLabels(options.ShowLabels, pod.Labels)); err != nil &#123;</div><div class="line">		return err</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	return nil</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>调用例子：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span> kubectl get pods</div><div class="line">NAME                         READY     STATUS    RESTARTS   AGE</div><div class="line">nginx-1487191267-0t8x3       1/1       Running   2          1d</div><div class="line">ubuntu-ssh-589933015-2lhgb   1/1       Running   21         19d</div></pre></td></tr></table></figure></p>
<p>或者<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span> kubectl get pods -o wide</div><div class="line">NAME                         READY     STATUS    RESTARTS   AGE       IP           NODE</div><div class="line">nginx-1487191267-0t8x3       1/1       Running   2          1d        172.17.0.4   fankang</div><div class="line">ubuntu-ssh-589933015-2lhgb   1/1       Running   21         19d       172.17.0.5   fankang</div></pre></td></tr></table></figure></p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="https://fankangbest.github.com/2017/07/19/Kubectl概念解读(五)-Printer-v1-5-2/" data-id="cj7770fgh000akcqsh56ok3hn" class="article-share-link">分享</a><div class="tags"><a href="/tags/kubernetes/">kubernetes</a><a href="/tags/kubernetes-v1-5-2/">kubernetes-v1.5.2</a></div><div class="post-nav"><a href="/2017/07/20/Kubectl概念解读(六)-Describer-v1-5-2/" class="pre">Kubectl概念解读(六)-Describer-v1.5.2</a><a href="/2017/07/15/Kubectl概念解读(四)-Mapper-v1-5-2/" class="next">Kubectl概念解读(四)-Mapper-v1.5.2</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="https://fankangbest.github.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/存储虚拟化/">存储虚拟化</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/容器虚拟化/">容器虚拟化</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/kubernetes/" style="font-size: 15px;">kubernetes</a> <a href="/tags/kubernetes-v1-5-2/" style="font-size: 15px;">kubernetes-v1.5.2</a> <a href="/tags/ceph/" style="font-size: 15px;">ceph</a> <a href="/tags/docker/" style="font-size: 15px;">docker</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/09/04/admission机制分析-v1-5-2/">admission机制分析-v1.5.2</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/28/cache解读(四)-SharedInformer-v1-5-2/">cache解读(四)-SharedInformer-v1.5.2</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/25/cache解读(三)-Controller-v1-5-2/">cache解读(三)-Controller-v1.5.2</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/23/cache解读(二)-Queue-v1-5-2/">cache解读(二)-Queue-v1.5.2</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/22/cache解读(一)-Store-v1-5-2/">cache解读(一)-Store-v1.5.2</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/21/reflector机制-v1-5-2/">reflector机制-v1.5.2</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/17/使用docker搭建Ceph环境/">使用docker搭建Ceph环境</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/16/storage解读(五)-etcdWatcher-v1-5-2/">storage解读(五)-etcdWatcher-v1.5.2</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/11/storage解读(四)-etcdHelper-v1-5-2/">storage解读(四)-etcdHelper-v1.5.2</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/10/storage解读(三)-storageDecorator-v1-5-2/">storage解读(三)-storageDecorator-v1.5.2</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://github.com/fankangbest" title="myGithub" target="_blank">myGithub</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2017 <a href="/." rel="nofollow">fankangbest.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>