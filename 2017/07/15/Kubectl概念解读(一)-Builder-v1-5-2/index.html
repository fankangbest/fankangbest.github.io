<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>Kubectl概念解读(一)-Builder-v1.5.2 | fankangbest</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/6.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Kubectl概念解读(一)-Builder-v1.5.2</h1><a id="logo" href="/.">fankangbest</a><p class="description">多听，少说，接受每一个人的责难，但是保留自己的最后裁决。</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Kubectl概念解读(一)-Builder-v1.5.2</h1><div class="post-meta">Jul 15, 2017<span> | </span><span class="category"><a href="/categories/容器虚拟化/">容器虚拟化</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span></div><div class="post-content"><h2 id="resource目录下的概念们"><a href="#resource目录下的概念们" class="headerlink" title="resource目录下的概念们"></a>resource目录下的概念们</h2><p>在看Kubectl的源码时，最头痛的是/pkg/kubectl/resource目录下各种概念。什么是builder，什么是info，什么是visitor。。。如果了解了这些概念，再来看Kubectl源码，那么就能起到事半功倍的效果。本次先对Builder进行较深程度的分析，然后分批次介绍其他概念。概念的理解可能带有一些主观的色彩，还请包涵。</p>
<h2 id="什么是Builder"><a href="#什么是Builder" class="headerlink" title="什么是Builder"></a>什么是Builder</h2><p>Builder定义在/pkg/kubectl/resource/builder.go中。Builder是Kubectl命令行信息的内部载体，可以通过Builder生成Result对象(后续介绍)。Builder大多方法支持链式调用，即<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">resource.NewBuilder(mapper, typer, resource.ClientMapperFunc(f.UnstructuredClientForMapping), runtime.UnstructuredJSONScheme).</div><div class="line">		NamespaceParam(cmdNamespace).DefaultNamespace().AllNamespaces(allNamespaces).</div><div class="line">		FilenameParam(enforceNamespace, &amp;options.FilenameOptions).</div><div class="line">		SelectorParam(selector).</div><div class="line">		ExportParam(export).</div><div class="line">		ResourceTypeOrNameArgs(<span class="literal">true</span>, args...).</div><div class="line">		ContinueOnError().</div><div class="line">		Latest().</div><div class="line">		Flatten().</div><div class="line">		Do()</div></pre></td></tr></table></figure></p>
<p>这是因为这些方法返回的对象自身。</p>
<p>先来看下Builder的定义。Builder中有一个mapper(后续介绍)，然后就是一些资源方面的字段，这些资源字段都有方法对其进行设置。其中，resources需要和names或selector配合使用。<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Builder provides convenience functions for taking arguments and parameters</span></div><div class="line"><span class="comment">// from the command line and converting them to a list of resources to iterate</span></div><div class="line"><span class="comment">// over using the Visitor interface.</span></div><div class="line"><span class="keyword">type</span> Builder <span class="keyword">struct</span> &#123;</div><div class="line">	mapper *Mapper</div><div class="line"></div><div class="line">	errs []error</div><div class="line"></div><div class="line">	paths  []Visitor</div><div class="line">	stream <span class="keyword">bool</span></div><div class="line">	dir    <span class="keyword">bool</span></div><div class="line"></div><div class="line">	selector  labels.Selector</div><div class="line">	selectAll <span class="keyword">bool</span></div><div class="line"></div><div class="line">	resources []<span class="keyword">string</span></div><div class="line"></div><div class="line">	namespace    <span class="keyword">string</span></div><div class="line">	allNamespace <span class="keyword">bool</span></div><div class="line">	names        []<span class="keyword">string</span></div><div class="line"></div><div class="line">	resourceTuples []resourceTuple</div><div class="line"></div><div class="line">	defaultNamespace <span class="keyword">bool</span></div><div class="line">	requireNamespace <span class="keyword">bool</span></div><div class="line"></div><div class="line">	flatten <span class="keyword">bool</span></div><div class="line">	latest  <span class="keyword">bool</span></div><div class="line"></div><div class="line">	requireObject <span class="keyword">bool</span></div><div class="line"></div><div class="line">	singleResourceType <span class="keyword">bool</span></div><div class="line">	continueOnError    <span class="keyword">bool</span></div><div class="line"></div><div class="line">	singular <span class="keyword">bool</span></div><div class="line"></div><div class="line">	export <span class="keyword">bool</span></div><div class="line"></div><div class="line">	schema validation.Schema</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="NewBuilder"><a href="#NewBuilder" class="headerlink" title="NewBuilder()"></a>NewBuilder()</h2><p>NewBuilder()生成一个Builder，新的Builder只设置了mapper，及标记requireObject为true。<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewBuilder</span><span class="params">(mapper meta.RESTMapper, typer runtime.ObjectTyper, clientMapper ClientMapper, decoder runtime.Decoder)</span> *<span class="title">Builder</span></span> &#123;</div><div class="line">	<span class="keyword">return</span> &amp;Builder&#123;</div><div class="line">		<span class="comment">//***把RESTMapper, ObjectTyper, ClientMapper, Decoder封装成kubectl的Mapper***//</span></div><div class="line">		mapper:        &amp;Mapper&#123;typer, mapper, clientMapper, decoder&#125;,</div><div class="line">		requireObject: <span class="literal">true</span>,</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="Do"><a href="#Do" class="headerlink" title="Do()"></a>Do()</h2><p>Do()先调用visitorResult()生成Result对象，然后设置Result对象中的visitor。现在我们必需牢记，Builder的Do()可以生成Result。<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//***返回一个*Result，Result可以使Infos()或Object()来获取执行结果***//</span></div><div class="line"><span class="comment">//***关于visitor层层封装，可以理解为每个visitor实现一定的功能，然后按一定的顺序来执行这些功能***//</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Builder)</span> <span class="title">Do</span><span class="params">()</span> *<span class="title">Result</span></span> &#123;</div><div class="line">	r := b.visitorResult()</div><div class="line">	<span class="keyword">if</span> r.err != <span class="literal">nil</span> &#123;</div><div class="line">		<span class="keyword">return</span> r</div><div class="line">	&#125;</div><div class="line">	<span class="comment">//***层层封装visitor***//</span></div><div class="line">	<span class="keyword">if</span> b.flatten &#123;</div><div class="line">		r.visitor = NewFlattenListVisitor(r.visitor, b.mapper)</div><div class="line">	&#125;</div><div class="line">	helpers := []VisitorFunc&#123;&#125;</div><div class="line">	<span class="keyword">if</span> b.defaultNamespace &#123;</div><div class="line">		helpers = <span class="built_in">append</span>(helpers, SetNamespace(b.namespace))</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">if</span> b.requireNamespace &#123;</div><div class="line">		helpers = <span class="built_in">append</span>(helpers, RequireNamespace(b.namespace))</div><div class="line">	&#125;</div><div class="line">	helpers = <span class="built_in">append</span>(helpers, FilterNamespace)</div><div class="line">	<span class="keyword">if</span> b.requireObject &#123;</div><div class="line">		helpers = <span class="built_in">append</span>(helpers, RetrieveLazy)</div><div class="line">	&#125;</div><div class="line">	r.visitor = NewDecoratedVisitor(r.visitor, helpers...)</div><div class="line">	<span class="keyword">if</span> b.continueOnError &#123;</div><div class="line">		r.visitor = ContinueOnErrorVisitor&#123;r.visitor&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> r</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="visitResult"><a href="#visitResult" class="headerlink" title="visitResult()"></a>visitResult()</h2><p>visitResult()会根据Builder中字段的设置情况来生成不同的Result。一般来说b.paths, b.selectors, b.resourceTuples, b.names只需设置一个即可。<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//***返回一个result对象***//</span></div><div class="line"><span class="comment">//***visitByPaths()等会生成info对象***//</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Builder)</span> <span class="title">visitorResult</span><span class="params">()</span> *<span class="title">Result</span></span> &#123;</div><div class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(b.errs) &gt; <span class="number">0</span> &#123;</div><div class="line">		<span class="keyword">return</span> &amp;Result&#123;err: utilerrors.NewAggregate(b.errs)&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">//***设置selector为labels.Everything()***//</span></div><div class="line">	<span class="keyword">if</span> b.selectAll &#123;</div><div class="line">		b.selector = labels.Everything()</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">// visit items specified by paths</span></div><div class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(b.paths) != <span class="number">0</span> &#123;</div><div class="line">		<span class="keyword">return</span> b.visitByPaths()</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">// visit selectors</span></div><div class="line">	<span class="keyword">if</span> b.selector != <span class="literal">nil</span> &#123;</div><div class="line">		<span class="keyword">return</span> b.visitBySelector()</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">// visit items specified by resource and name</span></div><div class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(b.resourceTuples) != <span class="number">0</span> &#123;</div><div class="line">		<span class="keyword">return</span> b.visitByResource()</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">// visit items specified by name</span></div><div class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(b.names) != <span class="number">0</span> &#123;</div><div class="line">		<span class="keyword">return</span> b.visitByName()</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(b.resources) != <span class="number">0</span> &#123;</div><div class="line">		<span class="keyword">return</span> &amp;Result&#123;err: fmt.Errorf(<span class="string">"resource(s) were provided, but no name, label selector, or --all flag specified"</span>)&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> &amp;Result&#123;err: missingResourceError&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="visitBySelector"><a href="#visitBySelector" class="headerlink" title="visitBySelector()"></a>visitBySelector()</h2><p>visitBySelector()生成一个Selector visitor，然后把该visitor封装成Result并返回。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">//***selector visitor的visitFunc会生成info***//</div><div class="line">func (b *Builder) visitBySelector() *Result &#123;</div><div class="line">	if len(b.names) != 0 &#123;</div><div class="line">		return &amp;Result&#123;err: fmt.Errorf(&quot;name cannot be provided when a selector is specified&quot;)&#125;</div><div class="line">	&#125;</div><div class="line">	if len(b.resourceTuples) != 0 &#123;</div><div class="line">		return &amp;Result&#123;err: fmt.Errorf(&quot;selectors and the all flag cannot be used when passing resource/name arguments&quot;)&#125;</div><div class="line">	&#125;</div><div class="line">	if len(b.resources) == 0 &#123;</div><div class="line">		return &amp;Result&#123;err: fmt.Errorf(&quot;at least one resource must be specified to use a selector&quot;)&#125;</div><div class="line">	&#125;</div><div class="line">	mappings, err := b.resourceMappings()</div><div class="line">	if err != nil &#123;</div><div class="line">		return &amp;Result&#123;err: err&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	visitors := []Visitor&#123;&#125;</div><div class="line">	for _, mapping := range mappings &#123;</div><div class="line">		//***生成client***//</div><div class="line">		client, err := b.mapper.ClientForMapping(mapping)</div><div class="line">		if err != nil &#123;</div><div class="line">			return &amp;Result&#123;err: err&#125;</div><div class="line">		&#125;</div><div class="line">		selectorNamespace := b.namespace</div><div class="line">		if mapping.Scope.Name() != meta.RESTScopeNameNamespace &#123;</div><div class="line">			selectorNamespace = &quot;&quot;</div><div class="line">		&#125;</div><div class="line">		visitors = append(visitors, NewSelector(client, mapping, selectorNamespace, b.selector, b.export))</div><div class="line">	&#125;</div><div class="line">	if b.continueOnError &#123;</div><div class="line">		return &amp;Result&#123;visitor: EagerVisitorList(visitors), sources: visitors&#125;</div><div class="line">	&#125;</div><div class="line">	return &amp;Result&#123;visitor: VisitorList(visitors), sources: visitors&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="visitByResource"><a href="#visitByResource" class="headerlink" title="visitByResource()"></a>visitByResource()</h2><p>visitByResource()使用resourceTuples生成Info(后续介绍)，Info本身也是个visitor，所以把Info打包成Result并返回。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div></pre></td><td class="code"><pre><div class="line">//***通过resource生成info***//</div><div class="line">func (b *Builder) visitByResource() *Result &#123;</div><div class="line">	// if b.singular is false, this could be by default, so double-check length</div><div class="line">	// of resourceTuples to determine if in fact it is singular or not</div><div class="line">	isSingular := b.singular</div><div class="line">	if !isSingular &#123;</div><div class="line">		isSingular = len(b.resourceTuples) == 1</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	if len(b.resources) != 0 &#123;</div><div class="line">		return &amp;Result&#123;singular: isSingular, err: fmt.Errorf(&quot;you may not specify individual resources and bulk resources in the same call&quot;)&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	// retrieve one client for each resource</div><div class="line">	mappings, err := b.resourceTupleMappings()</div><div class="line">	if err != nil &#123;</div><div class="line">		return &amp;Result&#123;singular: isSingular, err: err&#125;</div><div class="line">	&#125;</div><div class="line">	clients := make(map[string]RESTClient)</div><div class="line">	for _, mapping := range mappings &#123;</div><div class="line">		s := fmt.Sprintf(&quot;%s/%s&quot;, mapping.GroupVersionKind.GroupVersion().String(), mapping.Resource)</div><div class="line">		if _, ok := clients[s]; ok &#123;</div><div class="line">			continue</div><div class="line">		&#125;</div><div class="line">		client, err := b.mapper.ClientForMapping(mapping)</div><div class="line">		if err != nil &#123;</div><div class="line">			return &amp;Result&#123;err: err&#125;</div><div class="line">		&#125;</div><div class="line">		clients[s] = client</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	items := []Visitor&#123;&#125;</div><div class="line">	for _, tuple := range b.resourceTuples &#123;</div><div class="line">		mapping, ok := mappings[tuple.Resource]</div><div class="line">		if !ok &#123;</div><div class="line">			return &amp;Result&#123;singular: isSingular, err: fmt.Errorf(&quot;resource %q is not recognized: %v&quot;, tuple.Resource, mappings)&#125;</div><div class="line">		&#125;</div><div class="line">		s := fmt.Sprintf(&quot;%s/%s&quot;, mapping.GroupVersionKind.GroupVersion().String(), mapping.Resource)</div><div class="line">		client, ok := clients[s]</div><div class="line">		if !ok &#123;</div><div class="line">			return &amp;Result&#123;singular: isSingular, err: fmt.Errorf(&quot;could not find a client for resource %q&quot;, tuple.Resource)&#125;</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		selectorNamespace := b.namespace</div><div class="line">		if mapping.Scope.Name() != meta.RESTScopeNameNamespace &#123;</div><div class="line">			selectorNamespace = &quot;&quot;</div><div class="line">		&#125; else &#123;</div><div class="line">			if len(b.namespace) == 0 &#123;</div><div class="line">				errMsg := &quot;namespace may not be empty when retrieving a resource by name&quot;</div><div class="line">				if b.allNamespace &#123;</div><div class="line">					errMsg = &quot;a resource cannot be retrieved by name across all namespaces&quot;</div><div class="line">				&#125;</div><div class="line">				return &amp;Result&#123;singular: isSingular, err: fmt.Errorf(errMsg)&#125;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		//***生成info***//</div><div class="line">		info := NewInfo(client, mapping, selectorNamespace, tuple.Name, b.export)</div><div class="line">		items = append(items, info)</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	var visitors Visitor</div><div class="line">	if b.continueOnError &#123;</div><div class="line">		visitors = EagerVisitorList(items)</div><div class="line">	&#125; else &#123;</div><div class="line">		visitors = VisitorList(items)</div><div class="line">	&#125;</div><div class="line">	return &amp;Result&#123;singular: isSingular, visitor: visitors, sources: items&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="visitByName"><a href="#visitByName" class="headerlink" title="visitByName()"></a>visitByName()</h2><p>visitByName()先通过b.names来生成info，然后封装成Result返回。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//***kubectl get pods nginx-1487191267-47z76走此函数***//</span></div><div class="line"><span class="comment">//***通过resource name生成info***//</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Builder)</span> <span class="title">visitByName</span><span class="params">()</span> *<span class="title">Result</span></span> &#123;</div><div class="line">	isSingular := <span class="built_in">len</span>(b.names) == <span class="number">1</span></div><div class="line"></div><div class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(b.paths) != <span class="number">0</span> &#123;</div><div class="line">		<span class="keyword">return</span> &amp;Result&#123;singular: isSingular, err: fmt.Errorf(<span class="string">"when paths, URLs, or stdin is provided as input, you may not specify a resource by arguments as well"</span>)&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(b.resources) == <span class="number">0</span> &#123;</div><div class="line">		<span class="keyword">return</span> &amp;Result&#123;singular: isSingular, err: fmt.Errorf(<span class="string">"you must provide a resource and a resource name together"</span>)&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(b.resources) &gt; <span class="number">1</span> &#123;</div><div class="line">		<span class="keyword">return</span> &amp;Result&#123;singular: isSingular, err: fmt.Errorf(<span class="string">"you must specify only one resource"</span>)&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	mappings, err := b.resourceMappings()</div><div class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">		<span class="keyword">return</span> &amp;Result&#123;singular: isSingular, err: err&#125;</div><div class="line">	&#125;</div><div class="line">	mapping := mappings[<span class="number">0</span>]</div><div class="line"></div><div class="line">	client, err := b.mapper.ClientForMapping(mapping)</div><div class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">		<span class="keyword">return</span> &amp;Result&#123;err: err&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	selectorNamespace := b.namespace</div><div class="line">	<span class="keyword">if</span> mapping.Scope.Name() != meta.RESTScopeNameNamespace &#123;</div><div class="line">		selectorNamespace = <span class="string">""</span></div><div class="line">	&#125; <span class="keyword">else</span> &#123;</div><div class="line">		<span class="keyword">if</span> <span class="built_in">len</span>(b.namespace) == <span class="number">0</span> &#123;</div><div class="line">			errMsg := <span class="string">"namespace may not be empty when retrieving a resource by name"</span></div><div class="line">			<span class="keyword">if</span> b.allNamespace &#123;</div><div class="line">				errMsg = <span class="string">"a resource cannot be retrieved by name across all namespaces"</span></div><div class="line">			&#125;</div><div class="line">			<span class="keyword">return</span> &amp;Result&#123;singular: isSingular, err: fmt.Errorf(errMsg)&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	visitors := []Visitor&#123;&#125;</div><div class="line">	<span class="keyword">for</span> _, name := <span class="keyword">range</span> b.names &#123;</div><div class="line">		<span class="comment">//***生成info***//</span></div><div class="line">		info := NewInfo(client, mapping, selectorNamespace, name, b.export)</div><div class="line">		visitors = <span class="built_in">append</span>(visitors, info)</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> &amp;Result&#123;singular: isSingular, visitor: VisitorList(visitors), sources: visitors&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="visitByPaths"><a href="#visitByPaths" class="headerlink" title="visitByPaths()"></a>visitByPaths()</h2><p>visitByPaths()根据b.Paths生成Results。因为b.Paths本身就是个visitor数组。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//***Paths中的visitor会生成info***//</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Builder)</span> <span class="title">visitByPaths</span><span class="params">()</span> *<span class="title">Result</span></span> &#123;</div><div class="line">	singular := !b.dir &amp;&amp; !b.stream &amp;&amp; <span class="built_in">len</span>(b.paths) == <span class="number">1</span></div><div class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(b.resources) != <span class="number">0</span> &#123;</div><div class="line">		<span class="keyword">return</span> &amp;Result&#123;singular: singular, err: fmt.Errorf(<span class="string">"when paths, URLs, or stdin is provided as input, you may not specify resource arguments as well"</span>)&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(b.names) != <span class="number">0</span> &#123;</div><div class="line">		<span class="keyword">return</span> &amp;Result&#123;err: fmt.Errorf(<span class="string">"name cannot be provided when a path is specified"</span>)&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(b.resourceTuples) != <span class="number">0</span> &#123;</div><div class="line">		<span class="keyword">return</span> &amp;Result&#123;err: fmt.Errorf(<span class="string">"resource/name arguments cannot be provided when a path is specified"</span>)&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">var</span> visitors Visitor</div><div class="line">	<span class="keyword">if</span> b.continueOnError &#123;</div><div class="line">		<span class="comment">//***此处path也是visitor***//</span></div><div class="line">		<span class="comment">//***FileVisitor, StreamVisitor会生成info***//</span></div><div class="line">		visitors = EagerVisitorList(b.paths)</div><div class="line">	&#125; <span class="keyword">else</span> &#123;</div><div class="line">		visitors = VisitorList(b.paths)</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">// only items from disk can be refetched</span></div><div class="line">	<span class="keyword">if</span> b.latest &#123;</div><div class="line">		<span class="comment">// must flatten lists prior to fetching</span></div><div class="line">		<span class="keyword">if</span> b.flatten &#123;</div><div class="line">			visitors = NewFlattenListVisitor(visitors, b.mapper)</div><div class="line">		&#125;</div><div class="line">		<span class="comment">// must set namespace prior to fetching</span></div><div class="line">		<span class="keyword">if</span> b.defaultNamespace &#123;</div><div class="line">			visitors = NewDecoratedVisitor(visitors, SetNamespace(b.namespace))</div><div class="line">		&#125;</div><div class="line">		visitors = NewDecoratedVisitor(visitors, RetrieveLatest)</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">if</span> b.selector != <span class="literal">nil</span> &#123;</div><div class="line">		visitors = NewFilteredVisitor(visitors, FilterBySelector(b.selector))</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> &amp;Result&#123;singular: singular, visitor: visitors, sources: b.paths&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>接下来介绍Builder的字段设置函数。</p>
<h2 id="Schema"><a href="#Schema" class="headerlink" title="Schema()"></a>Schema()</h2><p>Schema()设置Builder的schema字段。schema可以对资源名称进行规范检查。<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Builder)</span> <span class="title">Schema</span><span class="params">(schema validation.Schema)</span> *<span class="title">Builder</span></span> &#123;</div><div class="line">	b.schema = schema</div><div class="line">	<span class="keyword">return</span> b</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="FilenameParam"><a href="#FilenameParam" class="headerlink" title="FilenameParam()"></a>FilenameParam()</h2><p>FilenameParam()可以处理不同的输入方式，并设置Paths字段。如<code>kubectl create -f abc.yaml</code>，则filenameOptions为&amp;{[/home/abc.yaml] false}。<br>FilenameParam()目前支持标准输入，URL方式，文件方式，对应的支持函数为Stdin(), URL(), Path()。<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Builder)</span> <span class="title">FilenameParam</span><span class="params">(enforceNamespace <span class="keyword">bool</span>, filenameOptions *FilenameOptions)</span> *<span class="title">Builder</span></span> &#123;</div><div class="line">	recursive := filenameOptions.Recursive</div><div class="line">	paths := filenameOptions.Filenames</div><div class="line">	<span class="keyword">for</span> _, s := <span class="keyword">range</span> paths &#123;</div><div class="line">		<span class="keyword">switch</span> &#123;</div><div class="line">		<span class="comment">//***标准输入***//</span></div><div class="line">		<span class="keyword">case</span> s == <span class="string">"-"</span>:</div><div class="line">			b.Stdin()</div><div class="line">		<span class="comment">//***URL***//</span></div><div class="line">		<span class="keyword">case</span> strings.Index(s, <span class="string">"http://"</span>) == <span class="number">0</span> || strings.Index(s, <span class="string">"https://"</span>) == <span class="number">0</span>:</div><div class="line">			url, err := url.Parse(s)</div><div class="line">			<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">				b.errs = <span class="built_in">append</span>(b.errs, fmt.Errorf(<span class="string">"the URL passed to filename %q is not valid: %v"</span>, s, err))</div><div class="line">				<span class="keyword">continue</span></div><div class="line">			&#125;</div><div class="line">			b.URL(defaultHttpGetAttempts, url)</div><div class="line">		<span class="keyword">default</span>:</div><div class="line">			<span class="keyword">if</span> !recursive &#123;</div><div class="line">				b.singular = <span class="literal">true</span></div><div class="line">			&#125;</div><div class="line">			<span class="comment">//***文件或目录输入***//</span></div><div class="line">			b.Path(recursive, s)</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">//***如果enforceNamespace为true，则调用RequireNamespace()***//</span></div><div class="line">	<span class="keyword">if</span> enforceNamespace &#123;</div><div class="line">		b.RequireNamespace()</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">return</span> b</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="Stdin"><a href="#Stdin" class="headerlink" title="Stdin()"></a>Stdin()</h2><p>Stdin()会调用FileVIsitorForSTDIN()生成一个visitor，然后把该visitor加入到paths中。<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//***在builder的paths中加入stdin Visitor***//</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Builder)</span> <span class="title">Stdin</span><span class="params">()</span> *<span class="title">Builder</span></span> &#123;</div><div class="line">	b.stream = <span class="literal">true</span></div><div class="line">	b.paths = <span class="built_in">append</span>(b.paths, FileVisitorForSTDIN(b.mapper, b.schema))</div><div class="line">	<span class="keyword">return</span> b</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="URL"><a href="#URL" class="headerlink" title="URL()"></a>URL()</h2><p>URL()先生成一个url visitor，然后把该visitor加入到paths中。<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//***在builder的paths中加入URL Visitor***//</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Builder)</span> <span class="title">URL</span><span class="params">(httpAttemptCount <span class="keyword">int</span>, urls ...*url.URL)</span> *<span class="title">Builder</span></span> &#123;</div><div class="line">	<span class="keyword">for</span> _, u := <span class="keyword">range</span> urls &#123;</div><div class="line">		b.paths = <span class="built_in">append</span>(b.paths, &amp;URLVisitor&#123;</div><div class="line">			URL:              u,</div><div class="line">			StreamVisitor:    NewStreamVisitor(<span class="literal">nil</span>, b.mapper, u.String(), b.schema),</div><div class="line">			HttpAttemptCount: httpAttemptCount,</div><div class="line">		&#125;)</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> b</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="Stream"><a href="#Stream" class="headerlink" title="Stream()"></a>Stream()</h2><p>Stream()先生成一个stream visitor，然后把该visitor加入到paths中。<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//***在builder的paths中加入stream Visitor***//</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Builder)</span> <span class="title">Stream</span><span class="params">(r io.Reader, name <span class="keyword">string</span>)</span> *<span class="title">Builder</span></span> &#123;</div><div class="line">	b.stream = <span class="literal">true</span></div><div class="line">	b.paths = <span class="built_in">append</span>(b.paths, NewStreamVisitor(r, b.mapper, name, b.schema))</div><div class="line">	<span class="keyword">return</span> b</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="Path"><a href="#Path" class="headerlink" title="Path()"></a>Path()</h2><p>Path()把路径转换成file visitor,然后加入到paths中。<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//***把path转换成file Visitor，然后加入到paths中***//</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Builder)</span> <span class="title">Path</span><span class="params">(recursive <span class="keyword">bool</span>, paths ...<span class="keyword">string</span>)</span> *<span class="title">Builder</span></span> &#123;</div><div class="line">	<span class="keyword">for</span> _, p := <span class="keyword">range</span> paths &#123;</div><div class="line">		_, err := os.Stat(p)</div><div class="line">		<span class="keyword">if</span> os.IsNotExist(err) &#123;</div><div class="line">			b.errs = <span class="built_in">append</span>(b.errs, fmt.Errorf(<span class="string">"the path %q does not exist"</span>, p))</div><div class="line">			<span class="keyword">continue</span></div><div class="line">		&#125;</div><div class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">			b.errs = <span class="built_in">append</span>(b.errs, fmt.Errorf(<span class="string">"the path %q cannot be accessed: %v"</span>, p, err))</div><div class="line">			<span class="keyword">continue</span></div><div class="line">		&#125;</div><div class="line"></div><div class="line">		<span class="comment">//***把paths转换成file Visitors***//</span></div><div class="line">		visitors, err := ExpandPathsToFileVisitors(b.mapper, p, recursive, FileExtensions, b.schema)</div><div class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">			b.errs = <span class="built_in">append</span>(b.errs, fmt.Errorf(<span class="string">"error reading %q: %v"</span>, p, err))</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">if</span> <span class="built_in">len</span>(visitors) &gt; <span class="number">1</span> &#123;</div><div class="line">			b.dir = <span class="literal">true</span></div><div class="line">		&#125;</div><div class="line"></div><div class="line">		<span class="comment">//***加入到paths中***//</span></div><div class="line">		b.paths = <span class="built_in">append</span>(b.paths, visitors...)</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> b</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="ResourceTypes"><a href="#ResourceTypes" class="headerlink" title="ResourceTypes()"></a>ResourceTypes()</h2><p>ResourceTypes()设置Builder的resources字段，如kubectl get pods abc，则resources为pods<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//***设置resources***//</span></div><div class="line"><span class="comment">//***builder resources中存储的是需要处理的类型***//</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Builder)</span> <span class="title">ResourceTypes</span><span class="params">(types ...<span class="keyword">string</span>)</span> *<span class="title">Builder</span></span> &#123;</div><div class="line">	b.resources = <span class="built_in">append</span>(b.resources, types...)</div><div class="line">	<span class="keyword">return</span> b</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="ResourceNames"><a href="#ResourceNames" class="headerlink" title="ResourceNames()"></a>ResourceNames()</h2><p>ResourceNames()设置resourceTuples字段，表示需要访问的对象。如果kubectl logs nginx，那么ResourceNames()会把”nginx”和Builder中的resource(logs命令中设置为pods)，组成(pods, nginx)加入到resourceTuples中。<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Builder)</span> <span class="title">ResourceNames</span><span class="params">(resource <span class="keyword">string</span>, names ...<span class="keyword">string</span>)</span> *<span class="title">Builder</span></span> &#123;</div><div class="line">	<span class="keyword">for</span> _, name := <span class="keyword">range</span> names &#123;</div><div class="line">		<span class="comment">// See if this input string is of type/name format</span></div><div class="line">		tuple, ok, err := splitResourceTypeName(name)</div><div class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">			b.errs = <span class="built_in">append</span>(b.errs, err)</div><div class="line">			<span class="keyword">return</span> b</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		<span class="keyword">if</span> ok &#123;</div><div class="line">			b.resourceTuples = <span class="built_in">append</span>(b.resourceTuples, tuple)</div><div class="line">			<span class="keyword">continue</span></div><div class="line">		&#125;</div><div class="line">		<span class="keyword">if</span> <span class="built_in">len</span>(resource) == <span class="number">0</span> &#123;</div><div class="line">			b.errs = <span class="built_in">append</span>(b.errs, fmt.Errorf(<span class="string">"the argument %q must be RESOURCE/NAME"</span>, name))</div><div class="line">			<span class="keyword">continue</span></div><div class="line">		&#125;</div><div class="line"></div><div class="line">		<span class="comment">// Use the given default type to create a resource tuple</span></div><div class="line">		b.resourceTuples = <span class="built_in">append</span>(b.resourceTuples, resourceTuple&#123;Resource: resource, Name: name&#125;)</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> b</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="SelectorParam"><a href="#SelectorParam" class="headerlink" title="SelectorParam()"></a>SelectorParam()</h2><p>SelectorParam()的参数为string,设置Builder的selector字段。<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//***设置selector***//</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Builder)</span> <span class="title">SelectorParam</span><span class="params">(s <span class="keyword">string</span>)</span> *<span class="title">Builder</span></span> &#123;</div><div class="line">	selector, err := labels.Parse(s)</div><div class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">		b.errs = <span class="built_in">append</span>(b.errs, fmt.Errorf(<span class="string">"the provided selector %q is not valid: %v"</span>, s, err))</div><div class="line">		<span class="keyword">return</span> b</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">if</span> selector.Empty() &#123;</div><div class="line">		<span class="keyword">return</span> b</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">if</span> b.selectAll &#123;</div><div class="line">		b.errs = <span class="built_in">append</span>(b.errs, fmt.Errorf(<span class="string">"found non empty selector %q with previously set 'all' parameter. "</span>, s))</div><div class="line">		<span class="keyword">return</span> b</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> b.Selector(selector)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="Selector"><a href="#Selector" class="headerlink" title="Selector()"></a>Selector()</h2><p>Selector()的参数为selector，直接设置Builder的selector字段。<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Builder)</span> <span class="title">Selector</span><span class="params">(selector labels.Selector)</span> *<span class="title">Builder</span></span> &#123;</div><div class="line">	b.selector = selector</div><div class="line">	<span class="keyword">return</span> b</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="ExportParam"><a href="#ExportParam" class="headerlink" title="ExportParam()"></a>ExportParam()</h2><p>用途未知。<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Builder)</span> <span class="title">ExportParam</span><span class="params">(export <span class="keyword">bool</span>)</span> *<span class="title">Builder</span></span> &#123;</div><div class="line">	b.export = export</div><div class="line">	<span class="keyword">return</span> b</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="NamespaceParam"><a href="#NamespaceParam" class="headerlink" title="NamespaceParam()"></a>NamespaceParam()</h2><p>NamespaceParam()可以设置Builder的namespace字段。<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//***设置namespace***//</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Builder)</span> <span class="title">NamespaceParam</span><span class="params">(namespace <span class="keyword">string</span>)</span> *<span class="title">Builder</span></span> &#123;</div><div class="line">	b.namespace = namespace</div><div class="line">	<span class="keyword">return</span> b</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="DefaultNamespace"><a href="#DefaultNamespace" class="headerlink" title="DefaultNamespace()"></a>DefaultNamespace()</h2><p>DefaultNamespace()可以设置Builder的defaultNamespace字段，表示如果namespace未指定，是否使用default namespace。<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//***设置DefaultNamespace***//</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Builder)</span> <span class="title">DefaultNamespace</span><span class="params">()</span> *<span class="title">Builder</span></span> &#123;</div><div class="line">	b.defaultNamespace = <span class="literal">true</span></div><div class="line">	<span class="keyword">return</span> b</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="AllNamespaces"><a href="#AllNamespaces" class="headerlink" title="AllNamespaces()"></a>AllNamespaces()</h2><p>AllNamespaces()可以设置Builder的allNamespace和namespace字段，表示访问NamespaceAll。<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//***把namespace设置为NamespaceAll***//</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Builder)</span> <span class="title">AllNamespaces</span><span class="params">(allNamespace <span class="keyword">bool</span>)</span> *<span class="title">Builder</span></span> &#123;</div><div class="line">	<span class="keyword">if</span> allNamespace &#123;</div><div class="line">		b.namespace = api.NamespaceAll</div><div class="line">	&#125;</div><div class="line">	b.allNamespace = allNamespace</div><div class="line">	<span class="keyword">return</span> b</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="RequireNamespace"><a href="#RequireNamespace" class="headerlink" title="RequireNamespace()"></a>RequireNamespace()</h2><p>RequireNamespace()可以设置Builder的requireNamespace字段。<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Builder)</span> <span class="title">RequireNamespace</span><span class="params">()</span> *<span class="title">Builder</span></span> &#123;</div><div class="line">	b.requireNamespace = <span class="literal">true</span></div><div class="line">	<span class="keyword">return</span> b</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="SelectAllParam"><a href="#SelectAllParam" class="headerlink" title="SelectAllParam()"></a>SelectAllParam()</h2><p>SelectAllParam()可以设置Builder的selectAll字段。与selector字段互斥。<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Builder)</span> <span class="title">SelectAllParam</span><span class="params">(selectAll <span class="keyword">bool</span>)</span> *<span class="title">Builder</span></span> &#123;</div><div class="line">	<span class="keyword">if</span> selectAll &amp;&amp; b.selector != <span class="literal">nil</span> &#123;</div><div class="line">		b.errs = <span class="built_in">append</span>(b.errs, fmt.Errorf(<span class="string">"setting 'all' parameter but found a non empty selector. "</span>))</div><div class="line">		<span class="keyword">return</span> b</div><div class="line">	&#125;</div><div class="line">	b.selectAll = selectAll</div><div class="line">	<span class="keyword">return</span> b</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="ResourceTypeOrNameArgs"><a href="#ResourceTypeOrNameArgs" class="headerlink" title="ResourceTypeOrNameArgs()"></a>ResourceTypeOrNameArgs()</h2><p>ResourceTypeOrNameArgs()可以设置Builder的names和resource字段。如执行<code>kubectl get pods/nginx-1487191267-b4w5j rc/abc</code>，则args为<code>[pods/nginx-1487191267-b4w5j rc/abc]</code>。<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Builder)</span> <span class="title">ResourceTypeOrNameArgs</span><span class="params">(allowEmptySelector <span class="keyword">bool</span>, args ...<span class="keyword">string</span>)</span> *<span class="title">Builder</span></span> &#123;</div><div class="line">	args = normalizeMultipleResourcesArgs(args)</div><div class="line">	<span class="keyword">if</span> ok, err := hasCombinedTypeArgs(args); ok &#123;</div><div class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">			b.errs = <span class="built_in">append</span>(b.errs, err)</div><div class="line">			<span class="keyword">return</span> b</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">for</span> _, s := <span class="keyword">range</span> args &#123;</div><div class="line">			tuple, ok, err := splitResourceTypeName(s)</div><div class="line">			<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">				b.errs = <span class="built_in">append</span>(b.errs, err)</div><div class="line">				<span class="keyword">return</span> b</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">if</span> ok &#123;</div><div class="line">				b.resourceTuples = <span class="built_in">append</span>(b.resourceTuples, tuple)</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> b</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(args) &gt; <span class="number">0</span> &#123;</div><div class="line">		<span class="comment">// Try replacing aliases only in types</span></div><div class="line">		args[<span class="number">0</span>] = b.ReplaceAliases(args[<span class="number">0</span>])</div><div class="line">	&#125;</div><div class="line">	<span class="comment">//***此处调用ResourceTypes()***//</span></div><div class="line">	<span class="keyword">switch</span> &#123;</div><div class="line">	<span class="keyword">case</span> <span class="built_in">len</span>(args) &gt; <span class="number">2</span>:</div><div class="line">		b.names = <span class="built_in">append</span>(b.names, args[<span class="number">1</span>:]...)</div><div class="line">		b.ResourceTypes(SplitResourceArgument(args[<span class="number">0</span>])...)</div><div class="line">	<span class="keyword">case</span> <span class="built_in">len</span>(args) == <span class="number">2</span>:</div><div class="line">		b.names = <span class="built_in">append</span>(b.names, args[<span class="number">1</span>])</div><div class="line">		b.ResourceTypes(SplitResourceArgument(args[<span class="number">0</span>])...)</div><div class="line">	<span class="keyword">case</span> <span class="built_in">len</span>(args) == <span class="number">1</span>:</div><div class="line">		b.ResourceTypes(SplitResourceArgument(args[<span class="number">0</span>])...)</div><div class="line">		<span class="keyword">if</span> b.selector == <span class="literal">nil</span> &amp;&amp; allowEmptySelector &#123;</div><div class="line">			b.selector = labels.Everything()</div><div class="line">		&#125;</div><div class="line">	<span class="keyword">case</span> <span class="built_in">len</span>(args) == <span class="number">0</span>:</div><div class="line">	<span class="keyword">default</span>:</div><div class="line">		b.errs = <span class="built_in">append</span>(b.errs, fmt.Errorf(<span class="string">"arguments must consist of a resource or a resource and name"</span>))</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> b</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="Flatten"><a href="#Flatten" class="headerlink" title="Flatten()"></a>Flatten()</h2><p>Flatten()可以设置Builder的flatten字段。<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Builder)</span> <span class="title">Flatten</span><span class="params">()</span> *<span class="title">Builder</span></span> &#123;</div><div class="line">	b.flatten = <span class="literal">true</span></div><div class="line">	<span class="keyword">return</span> b</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="Latest"><a href="#Latest" class="headerlink" title="Latest()"></a>Latest()</h2><p>Latest()可以设置Builder的latest字段，用来标识获取URL或Path中最新的内容。<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Builder)</span> <span class="title">Latest</span><span class="params">()</span> *<span class="title">Builder</span></span> &#123;</div><div class="line">	b.latest = <span class="literal">true</span></div><div class="line">	<span class="keyword">return</span> b</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="RequireObject"><a href="#RequireObject" class="headerlink" title="RequireObject()"></a>RequireObject()</h2><p>RequireObject()可以设置Builder的requireObject字段。<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Builder)</span> <span class="title">RequireObject</span><span class="params">(require <span class="keyword">bool</span>)</span> *<span class="title">Builder</span></span> &#123;</div><div class="line">	b.requireObject = require</div><div class="line">	<span class="keyword">return</span> b</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="ContinueOnError"><a href="#ContinueOnError" class="headerlink" title="ContinueOnError()"></a>ContinueOnError()</h2><p>ContinueOnError()可以设置Builder的continueOnError字段为true，在封装visitor时会用到该字段。<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Builder)</span> <span class="title">ContinueOnError</span><span class="params">()</span> *<span class="title">Builder</span></span> &#123;</div><div class="line">	b.continueOnError = <span class="literal">true</span></div><div class="line">	<span class="keyword">return</span> b</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="mappingFor"><a href="#mappingFor" class="headerlink" title="mappingFor()"></a>mappingFor()</h2><p>mappingFor()使用参数resource，然后依据mapper字段，构建RESTMapping并返回。RESTMapping表示resource和GVK的对应关系。<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//***返回RESTMapping***//</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Builder)</span> <span class="title">mappingFor</span><span class="params">(resourceArg <span class="keyword">string</span>)</span> <span class="params">(*meta.RESTMapping, error)</span></span> &#123;</div><div class="line">	<span class="comment">//***把resource构造成GVR***//</span></div><div class="line">	fullySpecifiedGVR, groupResource := unversioned.ParseResourceArg(resourceArg)</div><div class="line">	gvk := unversioned.GroupVersionKind&#123;&#125;</div><div class="line">	<span class="keyword">if</span> fullySpecifiedGVR != <span class="literal">nil</span> &#123;</div><div class="line">		gvk, _ = b.mapper.KindFor(*fullySpecifiedGVR)</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">if</span> gvk.Empty() &#123;</div><div class="line">		<span class="keyword">var</span> err error</div><div class="line">		gvk, err = b.mapper.KindFor(groupResource.WithVersion(<span class="string">""</span>))</div><div class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">			<span class="keyword">return</span> <span class="literal">nil</span>, err</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">//***RESTMapping()定义在/pkg/api/meta/restmapper.go中***//</span></div><div class="line">	<span class="keyword">return</span> b.mapper.RESTMapping(gvk.GroupKind(), gvk.Version)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="resourceMappings"><a href="#resourceMappings" class="headerlink" title="resourceMappings()"></a>resourceMappings()</h2><p>resourceMappings()把Builder中的resource传递给上面的mappingFor()生成RESTMapping。<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//***把builder中resources转换成mapping***//</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Builder)</span> <span class="title">resourceMappings</span><span class="params">()</span> <span class="params">([]*meta.RESTMapping, error)</span></span> &#123;</div><div class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(b.resources) &gt; <span class="number">1</span> &amp;&amp; b.singleResourceType &#123;</div><div class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, fmt.Errorf(<span class="string">"you may only specify a single resource type"</span>)</div><div class="line">	&#125;</div><div class="line">	mappings := []*meta.RESTMapping&#123;&#125;</div><div class="line">	<span class="keyword">for</span> _, r := <span class="keyword">range</span> b.resources &#123;</div><div class="line">		mapping, err := b.mappingFor(r)</div><div class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">			<span class="keyword">return</span> <span class="literal">nil</span>, err</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		mappings = <span class="built_in">append</span>(mappings, mapping)</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> mappings, <span class="literal">nil</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="resourceTupleMappings"><a href="#resourceTupleMappings" class="headerlink" title="resourceTupleMappings()"></a>resourceTupleMappings()</h2><p>resourceTupleMappings()把Builder中的resourceTuple转换成RESTMapping。<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Builder)</span> <span class="title">resourceTupleMappings</span><span class="params">()</span> <span class="params">(<span class="keyword">map</span>[<span class="keyword">string</span>]*meta.RESTMapping, error)</span></span> &#123;</div><div class="line">	mappings := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]*meta.RESTMapping)</div><div class="line">	canonical := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">struct</span>&#123;&#125;)</div><div class="line">	<span class="keyword">for</span> _, r := <span class="keyword">range</span> b.resourceTuples &#123;</div><div class="line">		<span class="keyword">if</span> _, ok := mappings[r.Resource]; ok &#123;</div><div class="line">			<span class="keyword">continue</span></div><div class="line">		&#125;</div><div class="line">		mapping, err := b.mappingFor(r.Resource)</div><div class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">			<span class="keyword">return</span> <span class="literal">nil</span>, err</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		mappings[mapping.Resource] = mapping</div><div class="line">		mappings[r.Resource] = mapping</div><div class="line">		canonical[mapping.Resource] = <span class="keyword">struct</span>&#123;&#125;&#123;&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(canonical) &gt; <span class="number">1</span> &amp;&amp; b.singleResourceType &#123;</div><div class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, fmt.Errorf(<span class="string">"you may only specify a single resource type"</span>)</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> mappings, <span class="literal">nil</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="https://fankangbest.github.com/2017/07/15/Kubectl概念解读(一)-Builder-v1-5-2/" data-id="cj9v211aj000j68qsvoi5b4xg" class="article-share-link">分享</a><div class="tags"><a href="/tags/kubernetes/">kubernetes</a><a href="/tags/kubernetes-v1-5-2/">kubernetes-v1.5.2</a></div><div class="post-nav"><a href="/2017/07/15/Kubectl概念解读(二)-Visitor-v1-5-2/" class="pre">Kubectl概念解读(二)-Visitor-v1.5.2</a><a href="/2017/07/15/RESTClient-DynamicClient和ClientSet-Demo/" class="next">RESTClient,DynamicClient和ClientSet Demo</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="https://fankangbest.github.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/GO语言/">GO语言</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/存储虚拟化/">存储虚拟化</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/容器虚拟化/">容器虚拟化</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/kubernetes/" style="font-size: 15px;">kubernetes</a> <a href="/tags/kubernetes-v1-5-2/" style="font-size: 15px;">kubernetes-v1.5.2</a> <a href="/tags/docker/" style="font-size: 15px;">docker</a> <a href="/tags/docker-v1-12-3/" style="font-size: 15px;">docker-v1.12.3</a> <a href="/tags/GO语言/" style="font-size: 15px;">GO语言</a> <a href="/tags/python/" style="font-size: 15px;">python</a> <a href="/tags/ceph/" style="font-size: 15px;">ceph</a> <a href="/tags/gRPC/" style="font-size: 15px;">gRPC</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/11/11/gRPC-demo/">gRPC-demo</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/31/kubernetes-controller分析(四)-garbagecollector-v1-5-2/">kubernetes-controller分析(四)-garbagecollector-v1.5.2</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/30/Docker镜像存储代码分析-layerStore-v1-12-3/">Docker镜像存储代码分析-layerStore-v1.12.3</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/29/Docker镜像存储代码分析-referenceStore-v1-12-3/">Docker镜像存储代码分析-referenceStore-v1.12.3</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/29/Docker镜像存储代码分析-imageStore-v1-12-3/">Docker镜像存储代码分析-imageStore-v1.12.3</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/26/kube-controller分析(三)-NamespaceController-v1-5-2/">kube-controller分析(三)-NamespaceController-v1.5.2</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/25/kubernetes-watcher-demo/">kubernetes-watcher-demo</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/24/kube-controller分析(二)-finalizer机制-v1-5-2/">kube-controller分析(二)-finalizer机制-v1.5.2</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/19/kube-controller分析(一)-sharedInformerFactory解读-v1-5-2/">kube-controller分析(一)-sharedInformerFactory解读-v1.5.2</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/18/kubernetes-client分析(四)-ClientSet-v1-5-2/">kubernetes-client分析(四)-ClientSet-v1.5.2</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://github.com/fankangbest" title="myGithub" target="_blank">myGithub</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2017 <a href="/." rel="nofollow">fankangbest.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>